---
title: Linux服务器编程专栏（一）
date: 2024-02-02 09:13:16
permalink: /linux/928912/
categories:
  - Linux
tags:
  - 服务器编程
author: 
  name: zhaoyb
  link: https://github.com/zhaoyb-coder
---

# Linux服务器编程专栏（一）

2024年，打算新开一个专栏，专门写清楚Linux服务器编程，包括TCP/IP协议、socket原理、内核系统调用（sendfile、mmap等）；

加油！！！

## Linux高级I/O函数

### 1、pipe

> pipe函数可用于创建一个管道，以实现进程间通信

pipe函数的定义如下：

```C
#include＜unistd.h＞ 
int pipe(int fd[2]);
// pipe函数的参数是一个包含两个int型整数的数组指针。
// 该函数成功时返回0，并将一对打开的文件描述符值填入其参数指向的数组。
// 如果失败，则返回-1并设置errno
```

C可以很简单的调用pipe函数来进行进程间通信，但是对于Java来说并不能直接调用pipe函数，Java封装了更高级别的API来实现进程间通信，比如：`java.io.PipedInputStream`和`java.io.PipedOutputStream`或者`java.nio.channels.Pipe`

实际的例子如下：

**使用PipedInputStream**

```java
import java.io.*;

public class PipeExample {
    public static void main(String[] args) throws IOException {
        PipedInputStream pipedInputStream = new PipedInputStream();
        PipedOutputStream pipedOutputStream = new PipedOutputStream();

        // 将输入流和输出流连接起来
        pipedInputStream.connect(pipedOutputStream);

        // 创建线程写入数据
        Thread writerThread = new Thread(() -> {
            try {
                String message = "Hello, world!";
                pipedOutputStream.write(message.getBytes());
                pipedOutputStream.close();
            } catch (IOException e) {
                e.printStackTrace();
            }
        });

        // 创建线程读取数据
        Thread readerThread = new Thread(() -> {
            try {
                int data;
                while ((data = pipedInputStream.read()) != -1) {
                    System.out.print((char) data);
                }
                pipedInputStream.close();
            } catch (IOException e) {
                e.printStackTrace();
            }
        });

        writerThread.start();
        readerThread.start();
    }
}

```

**使用java.nio.channels.Pipe**

```java
import java.io.IOException;
import java.nio.ByteBuffer;
import java.nio.channels.Pipe;

public class PipeExample {
    public static void main(String[] args) throws IOException {
        Pipe pipe = Pipe.open();
        Pipe.SinkChannel sinkChannel = pipe.sink();
        Pipe.SourceChannel sourceChannel = pipe.source();

        // 创建线程写入数据
        Thread writerThread = new Thread(() -> {
            try {
                ByteBuffer buffer = ByteBuffer.allocate(48);
                buffer.put("Hello, world!".getBytes());
                buffer.flip();
                while (buffer.hasRemaining()) {
                    sinkChannel.write(buffer);
                }
                sinkChannel.close();
            } catch (IOException e) {
                e.printStackTrace();
            }
        });

        // 创建线程读取数据
        Thread readerThread = new Thread(() -> {
            try {
                ByteBuffer buffer = ByteBuffer.allocate(48);
                int bytesRead = sourceChannel.read(buffer);
                while (bytesRead != -1) {
                    buffer.flip();
                    while (buffer.hasRemaining()) {
                        System.out.print((char) buffer.get());
                    }
                    buffer.clear();
                    bytesRead = sourceChannel.read(buffer);
                }
                sourceChannel.close();
            } catch (IOException e) {
                e.printStackTrace();
            }
        });

        writerThread.start();
        readerThread.start();
    }
}

```

### 2、dup/dup2



