---
title: Redis-概述
date: 2024-01-03 18:44:16
permalink: /data/932202/
categories:
  - Redis
tags:
  - Redis
author: 
  name: zhaoyb
  link: https://github.com/zhaoyb-coder
---

# Redis-概述

### 1、数据结构

![image-20240103162410843](https://raw.githubusercontent.com/zhaoyb-coder/pic-repo/main/image-20240103162410843.png)

#### 1.1、String

> 字符串对象的编码可以是int、raw或者embstr

+ 如果保存的是整数，并且整数可以被long表示，那么底层存储的字符串编码就是int

  ```shell
  # 设置num值为100
  > set num 100
  OK
  # 查看num编码
  > OBJECT ENCODING num
  "int"
  ```

+ 如果保存的是字符串，小于等于32字节，那么字符串对象编码使用embstr来保存

  ```shell
  > set msg "hello"
  OK
  > OBJECT ENCODING msg
  "embstr"
  ```

+ 如果保存的是字符串，大于32字节，那么字符串使用简单动态字符串（SDS）来保存，编码设置为raw

  ```shell
  > set bigmsg "long long ago......."
  OK
  # 查询字符串大小
  > STRLEN bigmsg
  (integer)40
  > OBJECT ENCODING bigmsg
  "raw"
  ```

#### 1.2、List

> 列表对象的编码可以是ziplist或者linkedlist

+ 列表对象保存的所有字符串元素的长度都小于64字节 并且 列表对象保存的元素数量小于512个，使用ziplist编码

  ```shell
  # 所有元素的长度都小于64字节
  > RPUSH blah "hello" "world" "again"
  (integer)3
  > OBJECT ENCODING blah
  "ziplist"
  #将一个65字节长的元素推入列表对象中
  > RPUSH blah "wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww"
  (integer) 4
  #编码已改变
  > OBJECT ENCODING blah
  "linkedlist"
  ```

+ 否则 使用linkedlist编码

  ```shell
  # 列表对象包含512个元素
  > EVAL "for i=1, 512 do redis.call('RPUSH', KEYS[1],i)end" 1 "integers"
  (nil)
  > LLEN integers
  (integer) 512
  > OBJECT ENCODING integers
  "ziplist"
  # 再向列表对象推入一个新元素，使得对象保存的元素数量达到513个
  > RPUSH integers 513
  (integer) 513
  # 编码已改变
  > OBJECT ENCODING integers
  "linkedlist"
  ```

#### 1.3、Hash

> 哈希对象的编码可以是ziplist或者hashtable

+ 哈希对象保存的所有键值对的键和值的字符串长度都小于64字节 并且 哈希对象保存的键值对数量小于512个，哈希对象使用ziplist编码

  ```shell
  # 哈希对象只包含一个键和值都不超过64个字节的键值对
  > HSET book name "Mastering C++ in 21 days"
  (integer) 1
  > OBJECT ENCODING book
  "ziplist"
  # 向哈希对象添加一个新的键值对，键的长度为66字节
  > HSET book long_long_long_long_long_long_long_long_long_long_long_description "content"
  (integer) 1
  # 编码已改变
  > OBJECT ENCODING book
  "hashtable"
  ```

+  否则 使用hashtable编码

  ```shell
  # 创建一个包含512个键值对的哈希对象
  > EVAL "for i=1, 512 do redis.call('HSET', KEYS[1], i, i)end" 1 "numbers"
  (nil)
  > HLEN numbers
  (integer) 512
  > OBJECT ENCODING numbers
  "ziplist"
  # 再向哈希对象添加一个新的键值对，使得键值对的数量变成513个
  > HMSET numbers "key" "value"
  OK
  > HLEN numbers
  (integer) 513
  # 编码改变
  > OBJECT ENCODING numbers
  "hashtable"
  ```

#### 1.4、Set

> 集合对象的编码可以是intset或者hashtable

+ 集合对象保存的所有元素都是整数值 并且 集合对象保存的元素数量不超过512个，使用intset编码

  ```shell
  > SADD numbers 1 3 5
  (integer) 3
  > OBJECT ENCODING numbers
  "intset"
  ```

+ 否则使用hashtable编码

  ```shell
  > SADD numbers "seven"
  (integer) 1
  > OBJECT ENCODING numbers
  "hashtable"
  ```

#### 1.5、ZSet

> 有序集合的编码可以是ziplist或者skiplist

+ 有序集合保存的元素数量小于128个 并且 有序集合保存的所有元素成员的长度都小于64字节，使用ziplist编码

  ```shell
  # 对象包含了128个元素
  > EVAL "for i=1, 128 do redis.call('ZADD', KEYS[1], i, i) end" 1 numbers
  (nil)
  > ZCARD numbers
  (integer) 128
  > OBJECT ENCODING numbers
  "ziplist"
  # 再添加一个新元素
  > ZADD numbers 3.14 pi
  (integer) 1
  # 对象包含的元素数量变为129个
  > ZCARD numbers
  (integer) 129
  # 编码已改变
  > OBJECT ENCODING numbers
  "skiplist"
  ```

+ 否则使用skiplist编码

  ```shell
  # 向有序集合添加一个成员只有三字节长的元素
  > ZADD blah 1.0 www
  (integer) 1
  > OBJECT ENCODING blah
  "ziplist"
  # 向有序集合添加一个成员为66字节长的元素
  > ZADD blah 2.0 ooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo
  (integer) 1
  # 编码已改变
  > OBJECT ENCODING blah
  "skiplist"
  ```



