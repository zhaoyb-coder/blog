---
title: Raft论文-读后记录
date: 2023-12-20 15:50:32
permalink: /dcs/3512ff/
categories:
  - 分布式
tags:
  - Raft
author: 
  name: zhaoyb
  link: https://github.com/zhaoyb-coder
---

# Raft论文-读后记录

## 1、Raft的正常工作流程：

1、客户端发送请求到服务端，此时服务端有多台机器，如果接收请求的是服务端不是领导者，那么会拒绝此次请求，并把领导者ip返回给客户端（客户端拿到领导者的ip之后请求领导者，如果此时领导者服务崩溃，那么客户端响应会超时，就会重复之前的操作，重新请求，然后获取领导者IP，直到请求成功），如果接受者是领导者，则直接进行后续请求

2、领导者接收到客户端请求之后，也就是接收到一个日志消息，共识模块会把消息添加到本机日志中，并与其它的追随者的共识模块进行通信，发送当前的日志消息，当大部分的追随者都进行了消息的响应，那么共识模块就会把当前日志提交到状态机中，并返回客户端。一旦提交，就意味着此次通信完成。

![image-20231220154742506](https://raw.githubusercontent.com/zhaoyb-coder/pic-repo/main/image-20231220154742506.png)

![image-20231220155719565](https://raw.githubusercontent.com/zhaoyb-coder/pic-repo/main/image-20231220155719565.png)

## 2、Raft的选举流程

每个节点内部有三个定时器，包括 选举定时器、心跳定时器、

节点刚开始都是【Follower】状态，随机选举定时器开始工作，如果定时器结束没有收到任何心跳，则最开始结束的【follower】节点转换状态变成后候选者【candidate】,变成候选者之后做了三件事，增加任期、为自己投票、发送RequestVote RPC，候选者会一直持续这种状态，直到发生了以下的其中一种情况

1、超过半数的【follower】进行投票响应，推选当前节点成为【leader】--->成为【leader】之后，发送心跳

2、收到其它节点的心跳，代表着当前集群已经存在【leader】，当前节点状态退回【follower】

3、一段时间过后没有任何反应，则代表发生了投票分割，则会继续重复进行投票

------

选举过程中可能出现的情况：Q&A

Q:【follower】节点收到了多个投票的请求（RequestVote RPC）?

A：每个follower节点在一个任期内只能投票一次，先到先得



Q：【candidate】候选节点收到了来自其它节点的AppendEntries RPC，就一定会退出选举吗？

A： 候选节点收到AppendEntries RPC的时候，会先比较当前RPC的任期是否大于等于自己的任期，如果小于则拒绝当前RPC，继续候选状态； 如果大于等于当前任期，则退出选举，变为【Follower】状态，并重置自己的选举定时器。（`AppendEntries RPC会重置follower的选举定时器`）



